<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LHT Team Attendance Tracker</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <style>
    body { background-color: #f8f9fa; padding: 20px; }
    table { width: 100%; margin-top: 30px; }
    th, td { text-align: center; vertical-align: middle; }
    .btn-sm { margin: 0 2px; }
    .timestamp { font-size: 0.8rem; color: #6c757d; margin-top: 4px; display: block; }
  </style>
</head>
<body>
  <div class="container">
    <div class="text-center">
      <h2>LHT Team Attendance Tracker</h2>
      <p id="currentTime" class="fw-bold"></p>
    </div>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Employee Name</th>
          <th>Login</th>
          <th>Break</th>
          <th>Back</th>
          <th>Logout</th>
        </tr>
      </thead>
      <tbody id="attendanceTable"></tbody>
    </table>
  </div>

  <script>
    const webhookURL = "https://hook.us2.make.com/em9jjvw8cl7jib2ff0ov56es0hh9fodh";

    const employees = [
      { id: "EMP001", name: "Adrian Gonzales" },
      { id: "EMP002", name: "Glendel Guden" },
      { id: "EMP003", name: "Jennifer Del Carmen" },
      { id: "EMP004", name: "Joven Moralejo" },
      { id: "EMP005", name: "Lutchie Villa" },
      { id: "EMP006", name: "Selene Rivera" }
    ];

    const actions = ["login", "break", "back", "logout"];

    // Clear localStorage if date changed
    const today = new Date().toLocaleDateString("en-US", { timeZone: "America/Chicago" });
    const lastDate = localStorage.getItem("lastLoginDate");
    if (lastDate !== today) {
      localStorage.clear();
      localStorage.setItem("lastLoginDate", today);
    }

    function updateTime() {
      const now = new Date().toLocaleString("en-US", {
        timeZone: "America/Chicago",
        weekday: "long",
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: true,
      });
      document.getElementById("currentTime").textContent = now;
    }

    function buildTable() {
      const tableBody = document.getElementById("attendanceTable");
      employees.sort((a, b) => a.name.localeCompare(b.name));
      employees.forEach(emp => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${emp.name}</td>`;

        actions.forEach(action => {
          const td = document.createElement("td");
          const button = document.createElement("button");
          button.className = "btn btn-outline-primary btn-sm";
          button.textContent = action.charAt(0).toUpperCase() + action.slice(1);
          const timestampSpan = document.createElement("span");
          timestampSpan.className = "timestamp";

          const saved = localStorage.getItem(`${emp.id}_${action}`);
          if (saved) {
            const parsed = JSON.parse(saved);
            timestampSpan.textContent = parsed.timeLabel;
            button.disabled = parsed.disabled;
            button.classList.remove("btn-outline-primary");
            button.classList.add("btn-success");
          }

          button.addEventListener("click", () => {
            const timestamp = new Date().toLocaleTimeString("en-US", { timeZone: "America/Chicago" });
            timestampSpan.textContent = timestamp;
            button.disabled = true;
            button.classList.remove("btn-outline-primary");
            button.classList.add("btn-success");

            localStorage.setItem(`${emp.id}_${action}`, JSON.stringify({
              timeLabel: timestamp,
              disabled: true
            }));

            fetch(webhookURL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                employee_id: emp.id,
                employee_name: emp.name,
                action: action,
                timestamp: timestamp
              })
            });
          });

          td.appendChild(button);
          td.appendChild(timestampSpan);
          row.appendChild(td);
        });

        tableBody.appendChild(row);
      });
    }

    updateTime();
    setInterval(updateTime, 1000);
    buildTable();
  </script>
</body>
</html>

