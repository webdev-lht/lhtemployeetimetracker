<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LHT Attendance Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .clock {
      font-size: 1.25rem;
      font-weight: bold;
    }
    .timestamp {
      display: block;
      font-size: 0.85rem;
      color: #555;
      margin-top: 0.25rem;
    }
    @media (min-width: 768px) {
      #mobile-clock { display: none; }
    }
    @media (max-width: 767.98px) {
      #desktop-clock { display: none; }
    }
  </style>
</head>
<body class="bg-light">

  <!-- Digital Clock (Top Right Desktop) -->
  <div class="container mt-3 mb-2 d-flex justify-content-end" id="desktop-clock">
    <div class="clock text-end" id="clockTop"></div>
  </div>

  <div class="container">
    <h2 class="text-center mb-4">LHT Team Attendance Tracker</h2>

    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle">
        <thead class="table-dark">
          <tr>
            <th>Employee Name</th>
            <th>Login</th>
            <th>Break</th>
            <th>Back</th>
            <th>Logout</th>
          </tr>
        </thead>
        <tbody id="employeeTable">
          <!-- Dynamic rows will be inserted -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Digital Clock (Bottom Mobile) -->
  <div class="container mt-4 mb-3 text-center" id="mobile-clock">
    <div class="clock" id="clockBottom"></div>
  </div>

  <script>
    const webhookURL = "https://hook.make.com/YOUR-WEBHOOK-ID"; // Replace with your Make.com webhook

    const employees = [
      { id: "EMP001", name: "Adrian Gonzales" },
      { id: "EMP006", name: "Glendel Guden" },
      { id: "EMP004", name: "Jennifer Del Carmen" },
      { id: "EMP002", name: "Joven Moralejo" },
      { id: "EMP005", name: "Lutchie VIlla" },
      { id: "EMP003", name: "Selene Rivera" }
    ];

    const actions = ["login", "break", "back", "logout"];

    // Sort alphabetically
    employees.sort((a, b) => a.name.localeCompare(b.name));

    function buildTable() {
      const tbody = document.getElementById("employeeTable");
      employees.forEach(emp => {
        const row = document.createElement("tr");
        const nameCell = document.createElement("td");
        nameCell.textContent = emp.name;
        row.appendChild(nameCell);

        actions.forEach(action => {
          const btnCell = document.createElement("td");
          const wrapper = document.createElement("div");
          const btn = document.createElement("button");
          const ts = document.createElement("span");

          btn.className = "btn btn-sm btn-outline-primary";
          btn.textContent = capitalize(action);
          btn.onclick = () => handleAction(emp.id, emp.name, action, btn, ts);

          ts.className = "timestamp";
          ts.id = `${emp.id}-${action}-timestamp`;

          wrapper.appendChild(btn);
          wrapper.appendChild(ts);
          btnCell.appendChild(wrapper);
          row.appendChild(btnCell);
        });

        tbody.appendChild(row);
      });
    }

    function handleAction(id, name, action, button, timestampSpan) {
      const timestamp = new Date().toISOString();

      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          employee_id: id,
          employee_name: name,
          action: action,
          timestamp: timestamp
        })
      })
      .then(res => {
        if (!res.ok) throw new Error("Webhook failed");
        const localTime = new Date().toLocaleTimeString();
        button.classList.remove("btn-outline-primary");
        button.classList.add("btn-success");
        button.disabled = true;
        timestampSpan.textContent = `✔ ${localTime}`;
      })
      .catch(err => {
        console.error(err);
        button.classList.add("btn-danger");
        timestampSpan.textContent = "Error";
      });
    }

    function capitalize(word) {
      return word.charAt(0).toUpperCase() + word.slice(1).replace("_", " ");
    }

    function updateClocks() {
      const now = new Date();
      const day = now.toLocaleDateString(undefined, { weekday: "long" });
      const time = now.toLocaleTimeString();
      const date = now.toLocaleDateString();
      const full = `${day}, ${date} – ${time}`;
      document.getElementById("clockTop").textContent = full;
      document.getElementById("clockBottom").textContent = full;
    }

    buildTable();
    setInterval(updateClocks, 1000);
  </script>
</body>
</html>
